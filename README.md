# time_series_predict
Time  series prediction for water

## Preprocess
- Station: 在原始数据上 -1, 使其取值范围为 [0, 147).
- Watershed: 在原始数据上 -1, 使其取值范围为 [0, 9).
- WeekOfYear: 表示采集日期在一年中所处的第几周，其取值范围为 [0, 53).
  - 原始数据为采集日期，经过数据分析，我们的数据并没有覆盖一年的所有天数。
  - 而且考虑到原始数据就是周数据，我们决定仅使用 WeekOfYear 代表时间信息作为输入
- 其他浮点型数据： 进行标准归一化。 x=(x-mean)/std

## 数据集
数据集的最小单元为站点(Station), 对于每个站点, 遍历每一个时间点 t, 得到一个样本：
- 将 [t, t+32) 时间段作为模型的输入
- 将 [t+32, t+33) 时间段作为模型的输出
- 相当于使用前 32 个值预测后面的 1 个值
- 之所以选择32：有些站点的时间序列长度只有50多，设太大了就没法针对这些站点进行训练了
- 之所以选择1：原因1是我们后续实际使用模型的时候也只预测一个值，原因2是我们这个数据集规律不太明显，预测8个值太难了

将一个站点的所有样本称为**站点数据集**，并划分为训练集和验证集。

将每个流域(Watershed)中的所有**站点数据集**整合起来称为**流域数据集**。

将所有**流域数据集**整合起来称为**整体数据集**。


## 模型训练与预测

### 模型选型
具体模型: LSTM, 1D_CNN, Transformer


使用**整体数据集**，因为我们需要一个比较大的数据集来选拔模型（数据集大有说服力）。

不同模型在整体数据集的训练集上训练，计算其在验证集上的精度，精度指标包括：R2, MAE, MSE. 

R2精度指标严重和 batch size 相关，参考性不大。


超参数选择：
- batch size：128
- 学习率：1e-5

模型对比

| model | 模型参数量 | R2 | MAE | MSE |

| 1D_CNN  | 0.6471 | 0.2508 | 0.1624 | 

| Transformer| 0.6743 | 0.2316 | 0.1496 |

模型参数量都不大，太大了容易过拟合。

### 模型预测

选定模型之后，使用训练好的模型对每个站点进行预测，具体操作如下：
- 遍历站点的每一个时间点，使用该时间点的前 32 个时间点作为模型输入，来预测当前时间点的值
- 因此只能预测第 32 个时间点之后的时间

模型的输出按照如下方式组织，每个 csv 中的前 32 行和真值是相同的

```angular2html
output
|--0watershed
    |-- 008station.csv
    |-- 009station.csv
    |-- 013station.csv
    ...
|--1watershed
|--2watershed

```

需要进行的工作，写脚本：
- 计算每个流域，每个站点的预测精度
- 绘图


### 可选的补充实验

按照重要性排序:
- 每个流域单独训练一个模型
- station_id 信息是否有用？
- 经纬度信息是否有用

## 超参数选择及理由：
- 输入序列长度为32: 
- 输出序列长度为1：任务简单，





